/*
 * Plot a chart reading of analog input values in realtime, with the
 * raw numeric values written in text below
 */

const byte pin_cs = 7;
const byte pin_dc = 2;
const byte pin_reset = 3;

#include <SPI.h>
#include "FTOLED.h"
#include "fonts/SystemFont5x7.h"

OLED oled(pin_cs, pin_dc, pin_reset);
// Text box takes up bottom 32 characters of the display (ie 4 rows)
//OLED_TextBox box(oled, 0, 0, 128, 32);

const int NUM_CHANNELS = 64;
const int NUM_POINTS = 8;
const int POINT_SPREAD = 50;

float c;

struct point {
  float x,y,z;
};

static const float Points[306][3] PROGMEM = { 
  { 1.4000,  0.0000,  2.4000}, 
  { 1.4000, -0.7840,  2.4000}, 
  { 0.7840, -1.4000,  2.4000}, 
  { 0.0000, -1.4000,  2.4000}, 
  { 1.3375,  0.0000,  2.5312}, 
  { 1.3375, -0.7490,  2.5312}, 
  { 0.7490, -1.3375,  2.5312}, 
  { 0.0000, -1.3375,  2.5312}, 
  { 1.4375,  0.0000,  2.5312}, 
  { 1.4375, -0.8050,  2.5312}, 
  { 0.8050, -1.4375,  2.5312}, 
  { 0.0000, -1.4375,  2.5312}, 
  { 1.5000,  0.0000,  2.4000}, 
  { 1.5000, -0.8400,  2.4000}, 
  { 0.8400, -1.5000,  2.4000}, 
  { 0.0000, -1.5000,  2.4000}, 
  {-0.7840, -1.4000,  2.4000}, 
  {-1.4000, -0.7840,  2.4000}, 
  {-1.4000,  0.0000,  2.4000}, 
  {-0.7490, -1.3375,  2.5312}, 
  {-1.3375, -0.7490,  2.5312}, 
  {-1.3375,  0.0000,  2.5312}, 
  {-0.8050, -1.4375,  2.5312}, 
  {-1.4375, -0.8050,  2.5312}, 
  {-1.4375,  0.0000,  2.5312}, 
  {-0.8400, -1.5000,  2.4000}, 
  {-1.5000, -0.8400,  2.4000}, 
  {-1.5000,  0.0000,  2.4000}, 
  {-1.4000,  0.7840,  2.4000}, 
  {-0.7840,  1.4000,  2.4000}, 
  { 0.0000,  1.4000,  2.4000}, 
  {-1.3375,  0.7490,  2.5312}, 
  {-0.7490,  1.3375,  2.5312}, 
  { 0.0000,  1.3375,  2.5312}, 
  {-1.4375,  0.8050,  2.5312}, 
  {-0.8050,  1.4375,  2.5312}, 
  { 0.0000,  1.4375,  2.5312}, 
  {-1.5000,  0.8400,  2.4000}, 
  {-0.8400,  1.5000,  2.4000}, 
  { 0.0000,  1.5000,  2.4000}, 
  { 0.7840,  1.4000,  2.4000}, 
  { 1.4000,  0.7840,  2.4000}, 
  { 0.7490,  1.3375,  2.5312}, 
  { 1.3375,  0.7490,  2.5312}, 
  { 0.8050,  1.4375,  2.5312}, 
  { 1.4375,  0.8050,  2.5312}, 
  { 0.8400,  1.5000,  2.4000}, 
  { 1.5000,  0.8400,  2.4000}, 
  { 1.7500,  0.0000,  1.8750}, 
  { 1.7500, -0.9800,  1.8750}, 
  { 0.9800, -1.7500,  1.8750}, 
  { 0.0000, -1.7500,  1.8750}, 
  { 2.0000,  0.0000,  1.3500}, 
  { 2.0000, -1.1200,  1.3500}, 
  { 1.1200, -2.0000,  1.3500}, 
  { 0.0000, -2.0000,  1.3500}, 
  { 2.0000,  0.0000,  0.9000}, 
  { 2.0000, -1.1200,  0.9000}, 
  { 1.1200, -2.0000,  0.9000}, 
  { 0.0000, -2.0000,  0.9000}, 
  {-0.9800, -1.7500,  1.8750}, 
  {-1.7500, -0.9800,  1.8750}, 
  {-1.7500,  0.0000,  1.8750}, 
  {-1.1200, -2.0000,  1.3500}, 
  {-2.0000, -1.1200,  1.3500}, 
  {-2.0000,  0.0000,  1.3500}, 
  {-1.1200, -2.0000,  0.9000}, 
  {-2.0000, -1.1200,  0.9000}, 
  {-2.0000,  0.0000,  0.9000}, 
  {-1.7500,  0.9800,  1.8750}, 
  {-0.9800,  1.7500,  1.8750}, 
  { 0.0000,  1.7500,  1.8750}, 
  {-2.0000,  1.1200,  1.3500}, 
  {-1.1200,  2.0000,  1.3500}, 
  { 0.0000,  2.0000,  1.3500}, 
  {-2.0000,  1.1200,  0.9000}, 
  {-1.1200,  2.0000,  0.9000}, 
  { 0.0000,  2.0000,  0.9000}, 
  { 0.9800,  1.7500,  1.8750}, 
  { 1.7500,  0.9800,  1.8750}, 
  { 1.1200,  2.0000,  1.3500}, 
  { 2.0000,  1.1200,  1.3500}, 
  { 1.1200,  2.0000,  0.9000}, 
  { 2.0000,  1.1200,  0.9000}, 
  { 2.0000,  0.0000,  0.4500}, 
  { 2.0000, -1.1200,  0.4500}, 
  { 1.1200, -2.0000,  0.4500}, 
  { 0.0000, -2.0000,  0.4500}, 
  { 1.5000,  0.0000,  0.2250}, 
  { 1.5000, -0.8400,  0.2250}, 
  { 0.8400, -1.5000,  0.2250}, 
  { 0.0000, -1.5000,  0.2250}, 
  { 1.5000,  0.0000,  0.1500}, 
  { 1.5000, -0.8400,  0.1500}, 
  { 0.8400, -1.5000,  0.1500}, 
  { 0.0000, -1.5000,  0.1500}, 
  {-1.1200, -2.0000,  0.4500}, 
  {-2.0000, -1.1200,  0.4500}, 
  {-2.0000,  0.0000,  0.4500}, 
  {-0.8400, -1.5000,  0.2250}, 
  {-1.5000, -0.8400,  0.2250}, 
  {-1.5000,  0.0000,  0.2250}, 
  {-0.8400, -1.5000,  0.1500}, 
  {-1.5000, -0.8400,  0.1500}, 
  {-1.5000,  0.0000,  0.1500}, 
  {-2.0000,  1.1200,  0.4500}, 
  {-1.1200,  2.0000,  0.4500}, 
  { 0.0000,  2.0000,  0.4500}, 
  {-1.5000,  0.8400,  0.2250}, 
  {-0.8400,  1.5000,  0.2250}, 
  { 0.0000,  1.5000,  0.2250}, 
  {-1.5000,  0.8400,  0.1500}, 
  {-0.8400,  1.5000,  0.1500}, 
  { 0.0000,  1.5000,  0.1500}, 
  { 1.1200,  2.0000,  0.4500}, 
  { 2.0000,  1.1200,  0.4500}, 
  { 0.8400,  1.5000,  0.2250}, 
  { 1.5000,  0.8400,  0.2250}, 
  { 0.8400,  1.5000,  0.1500}, 
  { 1.5000,  0.8400,  0.1500}, 
  {-1.6000,  0.0000,  2.0250}, 
  {-1.6000, -0.3000,  2.0250}, 
  {-1.5000, -0.3000,  2.2500}, 
  {-1.5000,  0.0000,  2.2500}, 
  {-2.3000,  0.0000,  2.0250}, 
  {-2.3000, -0.3000,  2.0250}, 
  {-2.5000, -0.3000,  2.2500}, 
  {-2.5000,  0.0000,  2.2500}, 
  {-2.7000,  0.0000,  2.0250}, 
  {-2.7000, -0.3000,  2.0250}, 
  {-3.0000, -0.3000,  2.2500}, 
  {-3.0000,  0.0000,  2.2500}, 
  {-2.7000,  0.0000,  1.8000}, 
  {-2.7000, -0.3000,  1.8000}, 
  {-3.0000, -0.3000,  1.8000}, 
  {-3.0000,  0.0000,  1.8000}, 
  {-1.5000,  0.3000,  2.2500}, 
  {-1.6000,  0.3000,  2.0250}, 
  {-2.5000,  0.3000,  2.2500}, 
  {-2.3000,  0.3000,  2.0250}, 
  {-3.0000,  0.3000,  2.2500}, 
  {-2.7000,  0.3000,  2.0250}, 
  {-3.0000,  0.3000,  1.8000}, 
  {-2.7000,  0.3000,  1.8000}, 
  {-2.7000,  0.0000,  1.5750}, 
  {-2.7000, -0.3000,  1.5750}, 
  {-3.0000, -0.3000,  1.3500}, 
  {-3.0000,  0.0000,  1.3500}, 
  {-2.5000,  0.0000,  1.1250}, 
  {-2.5000, -0.3000,  1.1250}, 
  {-2.6500, -0.3000,  0.9375}, 
  {-2.6500,  0.0000,  0.9375}, 
  {-2.0000, -0.3000,  0.9000}, 
  {-1.9000, -0.3000,  0.6000}, 
  {-1.9000,  0.0000,  0.6000}, 
  {-3.0000,  0.3000,  1.3500}, 
  {-2.7000,  0.3000,  1.5750}, 
  {-2.6500,  0.3000,  0.9375}, 
  {-2.5000,  0.3000,  1.1250}, 
  {-1.9000,  0.3000,  0.6000}, 
  {-2.0000,  0.3000,  0.9000}, 
  { 1.7000,  0.0000,  1.4250}, 
  { 1.7000, -0.6600,  1.4250}, 
  { 1.7000, -0.6600,  0.6000}, 
  { 1.7000,  0.0000,  0.6000}, 
  { 2.6000,  0.0000,  1.4250}, 
  { 2.6000, -0.6600,  1.4250}, 
  { 3.1000, -0.6600,  0.8250}, 
  { 3.1000,  0.0000,  0.8250}, 
  { 2.3000,  0.0000,  2.1000}, 
  { 2.3000, -0.2500,  2.1000}, 
  { 2.4000, -0.2500,  2.0250}, 
  { 2.4000,  0.0000,  2.0250}, 
  { 2.7000,  0.0000,  2.4000}, 
  { 2.7000, -0.2500,  2.4000}, 
  { 3.3000, -0.2500,  2.4000}, 
  { 3.3000,  0.0000,  2.4000}, 
  { 1.7000,  0.6600,  0.6000}, 
  { 1.7000,  0.6600,  1.4250}, 
  { 3.1000,  0.6600,  0.8250}, 
  { 2.6000,  0.6600,  1.4250}, 
  { 2.4000,  0.2500,  2.0250}, 
  { 2.3000,  0.2500,  2.1000}, 
  { 3.3000,  0.2500,  2.4000}, 
  { 2.7000,  0.2500,  2.4000}, 
  { 2.8000,  0.0000,  2.4750}, 
  { 2.8000, -0.2500,  2.4750}, 
  { 3.5250, -0.2500,  2.4938}, 
  { 3.5250,  0.0000,  2.4938}, 
  { 2.9000,  0.0000,  2.4750}, 
  { 2.9000, -0.1500,  2.4750}, 
  { 3.4500, -0.1500,  2.5125}, 
  { 3.4500,  0.0000,  2.5125}, 
  { 2.8000,  0.0000,  2.4000}, 
  { 2.8000, -0.1500,  2.4000}, 
  { 3.2000, -0.1500,  2.4000}, 
  { 3.2000,  0.0000,  2.4000}, 
  { 3.5250,  0.2500,  2.4938}, 
  { 2.8000,  0.2500,  2.4750}, 
  { 3.4500,  0.1500,  2.5125}, 
  { 2.9000,  0.1500,  2.4750}, 
  { 3.2000,  0.1500,  2.4000}, 
  { 2.8000,  0.1500,  2.4000}, 
  { 0.0000,  0.0000,  3.1500}, 
  { 0.0000, -0.0020,  3.1500}, 
  { 0.0020,  0.0000,  3.1500}, 
  { 0.8000,  0.0000,  3.1500}, 
  { 0.8000, -0.4500,  3.1500}, 
  { 0.4500, -0.8000,  3.1500}, 
  { 0.0000, -0.8000,  3.1500}, 
  { 0.0000,  0.0000,  2.8500}, 
  { 0.2000,  0.0000,  2.7000}, 
  { 0.2000, -0.1120,  2.7000}, 
  { 0.1120, -0.2000,  2.7000}, 
  { 0.0000, -0.2000,  2.7000}, 
  {-0.0020,  0.0000,  3.1500}, 
  {-0.4500, -0.8000,  3.1500}, 
  {-0.8000, -0.4500,  3.1500}, 
  {-0.8000,  0.0000,  3.1500}, 
  {-0.1120, -0.2000,  2.7000}, 
  {-0.2000, -0.1120,  2.7000}, 
  {-0.2000,  0.0000,  2.7000}, 
  { 0.0000,  0.0020,  3.1500}, 
  {-0.8000,  0.4500,  3.1500}, 
  {-0.4500,  0.8000,  3.1500}, 
  { 0.0000,  0.8000,  3.1500}, 
  {-0.2000,  0.1120,  2.7000}, 
  {-0.1120,  0.2000,  2.7000}, 
  { 0.0000,  0.2000,  2.7000}, 
  { 0.4500,  0.8000,  3.1500}, 
  { 0.8000,  0.4500,  3.1500}, 
  { 0.1120,  0.2000,  2.7000}, 
  { 0.2000,  0.1120,  2.7000}, 
  { 0.4000,  0.0000,  2.5500}, 
  { 0.4000, -0.2240,  2.5500}, 
  { 0.2240, -0.4000,  2.5500}, 
  { 0.0000, -0.4000,  2.5500}, 
  { 1.3000,  0.0000,  2.5500}, 
  { 1.3000, -0.7280,  2.5500}, 
  { 0.7280, -1.3000,  2.5500}, 
  { 0.0000, -1.3000,  2.5500}, 
  { 1.3000,  0.0000,  2.4000}, 
  { 1.3000, -0.7280,  2.4000}, 
  { 0.7280, -1.3000,  2.4000}, 
  { 0.0000, -1.3000,  2.4000}, 
  {-0.2240, -0.4000,  2.5500}, 
  {-0.4000, -0.2240,  2.5500}, 
  {-0.4000,  0.0000,  2.5500}, 
  {-0.7280, -1.3000,  2.5500}, 
  {-1.3000, -0.7280,  2.5500}, 
  {-1.3000,  0.0000,  2.5500}, 
  {-0.7280, -1.3000,  2.4000}, 
  {-1.3000, -0.7280,  2.4000}, 
  {-1.3000,  0.0000,  2.4000}, 
  {-0.4000,  0.2240,  2.5500}, 
  {-0.2240,  0.4000,  2.5500}, 
  { 0.0000,  0.4000,  2.5500}, 
  {-1.3000,  0.7280,  2.5500}, 
  {-0.7280,  1.3000,  2.5500}, 
  { 0.0000,  1.3000,  2.5500}, 
  {-1.3000,  0.7280,  2.4000}, 
  {-0.7280,  1.3000,  2.4000}, 
  { 0.0000,  1.3000,  2.4000}, 
  { 0.2240,  0.4000,  2.5500}, 
  { 0.4000,  0.2240,  2.5500}, 
  { 0.7280,  1.3000,  2.5500}, 
  { 1.3000,  0.7280,  2.5500}, 
  { 0.7280,  1.3000,  2.4000}, 
  { 1.3000,  0.7280,  2.4000}, 
  { 0.0000,  0.0000,  0.0000}, 
  { 1.5000,  0.0000,  0.1500}, 
  { 1.5000,  0.8400,  0.1500}, 
  { 0.8400,  1.5000,  0.1500}, 
  { 0.0000,  1.5000,  0.1500}, 
  { 1.5000,  0.0000,  0.0750}, 
  { 1.5000,  0.8400,  0.0750}, 
  { 0.8400,  1.5000,  0.0750}, 
  { 0.0000,  1.5000,  0.0750}, 
  { 1.4250,  0.0000,  0.0000}, 
  { 1.4250,  0.7980,  0.0000}, 
  { 0.7980,  1.4250,  0.0000}, 
  { 0.0000,  1.4250,  0.0000}, 
  {-0.8400,  1.5000,  0.1500}, 
  {-1.5000,  0.8400,  0.1500}, 
  {-1.5000,  0.0000,  0.1500}, 
  {-0.8400,  1.5000,  0.0750}, 
  {-1.5000,  0.8400,  0.0750}, 
  {-1.5000,  0.0000,  0.0750}, 
  {-0.7980,  1.4250,  0.0000}, 
  {-1.4250,  0.7980,  0.0000}, 
  {-1.4250,  0.0000,  0.0000}, 
  {-1.5000, -0.8400,  0.1500}, 
  {-0.8400, -1.5000,  0.1500}, 
  { 0.0000, -1.5000,  0.1500}, 
  {-1.5000, -0.8400,  0.0750}, 
  {-0.8400, -1.5000,  0.0750}, 
  { 0.0000, -1.5000,  0.0750}, 
  {-1.4250, -0.7980,  0.0000}, 
  {-0.7980, -1.4250,  0.0000}, 
  { 0.0000, -1.4250,  0.0000}, 
  { 0.8400, -1.5000,  0.1500}, 
  { 1.5000, -0.8400,  0.1500}, 
  { 0.8400, -1.5000,  0.0750}, 
  { 1.5000, -0.8400,  0.0750}, 
  { 0.7980, -1.4250,  0.0000}, 
  { 1.4250, -0.7980,  0.0000} 
}; 

  OLED_Colour COLOURS[NUM_CHANNELS];



void setup() {
//  for (int i=0; i<NUM_POINTS; ++i) 
//  {
//    Points[i].x = random(-POINT_SPREAD, POINT_SPREAD);
//    Points[i].y = random(-POINT_SPREAD, POINT_SPREAD);
//    Points[i].z = random(-POINT_SPREAD, POINT_SPREAD);
//    Points[i].col = random(NUM_CHANNELS);
//  }
  
  oled.begin();
  oled.selectFont(System5x7);

  for (byte i = 0; i<NUM_CHANNELS; ++i) {
    COLOURS[i] = { 255 * i / NUM_CHANNELS, 0, 255 * (255 - i)  / NUM_CHANNELS};
  }
 
}

void loop() {
  OLED_Colour black = {0, 0, 0};
   oled.fillScreen(black);
   float scale = 20;

   float a11 = scale * sin(c);
   float a12 = 0;
   float a13 = scale * cos(c);
   
   float a21  = 0;
   float a22  = scale;
   float a23  = 0;

   float a31  = scale * -sin(c);
   float a32  = 0;
   float a33  = scale * cos(c);
    
  for (int i = 0; i<306; ++i)
{
//   float nx = a11*Points[i].x + a12*Points[i].y + a13*Points[i].z;
//   float ny = a21*Points[i].x + a22*Points[i].y + a23*Points[i].z;
//   float nz = a31*Points[i].x + a32*Points[i].y + a33*Points[i].z;

//    int sx = (nx ) + 64;
//    int sy = (ny ) + 64;


    int sx = (pgm_read_float( &Points[i][0]) * 20 ) + 64;
    int sy = (pgm_read_float( &Points[i][1]) * 20 ) + 64;
    
    if (sx >= 0 && sx < 127 && sy >= 0 && sy < 127) {
      oled.setPixel(sx, sy, WHITE);
    }
  delay(2000);
  c += 0.005;
}
  
}
